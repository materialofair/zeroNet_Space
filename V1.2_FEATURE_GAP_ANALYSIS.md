# 零网络空间 V1.2 功能差距分析

**文档版本**: 1.0  
**创建日期**: 2025-11-15  
**分析目标**: 对比当前实现与定位书V1.2版本要求，明确功能缺口

---

## 📊 当前实现状态（V1.0）

### ✅ 已完成功能

#### 1. 核心架构
- ✅ SwiftUI + SwiftData 架构
- ✅ MVVM 设计模式
- ✅ 完全离线运行（无网络代码）
- ✅ 本地加密存储（EncryptionService）
- ✅ Keychain 密钥管理（KeychainService）

#### 2. 认证系统
- ✅ 密码设置流程（SetupPasswordView）
- ✅ 登录验证（LoginView）
- ✅ 认证状态管理（AuthenticationViewModel）
- ✅ 启动页展示（LaunchScreenView）

#### 3. 媒体管理
- ✅ 照片/视频加密存储
- ✅ 文件导入（MediaImportService）
- ✅ 文件夹系统（Folder模型）
- ✅ 标签管理（Tag模型）
- ✅ 网格视图展示（GalleryView）
- ✅ 批量选择操作

#### 4. 文件操作
- ✅ PDF/文档加密存储
- ✅ 文件预览（FilePreviewView）
- ✅ 文件加载服务（FileStorageService）

#### 5. 用户界面
- ✅ 主标签栏（MainTabView）
- ✅ 设置页面（SettingsView）
- ✅ 网格布局调整
- ✅ 排序功能

---

## 🎯 V1.2 目标功能要求

根据产品定位书，V1.2版本需要实现以下四大核心功能：

### 1. 伪装界面模式（计算器伪装）⭐⭐⭐
**用户需求**:
> 伪装界面模式是一个计算器，当用户在计算器输入密码点击确定的时候就进入主页面，这个时候就没有一进入的密码输入页面了。

**功能描述**:
- 应用启动时显示计算器界面（而非登录界面）
- 计算器可以正常使用（基础四则运算）
- 在计算器中输入特定密码序列 + 按"="确认
- 密码正确后进入真实的主应用界面
- 用户可在设置中开启/关闭伪装模式

### 2. 无网络验证界面 ⭐⭐⭐
**用户需求**:
> 无网络验证界面需要实现

**功能描述**:
- 向用户可视化展示应用的零网络特性
- 显示网络权限状态（已禁用）
- 展示安全承诺和隐私保护机制
- 可能包含代码级验证说明

**现状**: 已有 `NetworkVerificationView.swift` 文件，需要完善实现

### 3. 隐藏空间（第二密码空间）⭐⭐
**用户需求**:
> 隐藏空间是一个第二密码开启的空间，在里面就是一个记事本，这是个可选功能，如果用户不设置第二密码就没有隐藏空间。

**功能描述**:
- 用户可选择性设置第二密码
- 第二密码解锁后进入隐藏空间
- 隐藏空间内包含加密笔记本功能
- 支持创建、编辑、删除笔记
- 笔记使用独立的加密密钥
- 未设置第二密码时，隐藏空间功能不可见

### 4. 文件批量操作 ⭐
**功能描述**:
- 批量选择照片/视频/文件
- 批量移动到文件夹
- 批量添加标签
- 批量删除
- 批量导出（加密导出）

**现状**: 部分实现（批量选择和标签），需要增强功能

### 5. 深色模式 ⭐
**功能描述**:
- 支持系统深色模式
- 自定义颜色主题适配
- 所有界面深色模式适配

---

## ❌ 功能缺口清单

### 🔴 高优先级（核心体验）

| 功能模块 | 当前状态 | 缺失内容 | 优先级 |
|---------|---------|---------|-------|
| 伪装界面（计算器） | ❌ 未实现 | 完整计算器UI + 密码输入逻辑 + 设置开关 | P0 |
| 无网络验证界面 | ⚠️ 文件存在但未实现 | UI设计 + 验证逻辑 + 说明文案 | P0 |
| 隐藏空间核心 | ❌ 未实现 | 第二密码管理 + 独立空间入口 | P1 |
| 隐藏空间笔记 | ❌ 未实现 | 笔记模型 + 编辑器UI + 加密存储 | P1 |

### 🟡 中优先级（功能增强）

| 功能模块 | 当前状态 | 缺失内容 | 优先级 |
|---------|---------|---------|-------|
| 文件批量操作增强 | ⚠️ 部分实现 | 批量移动、批量导出功能 | P2 |
| 深色模式 | ❌ 未实现 | 颜色主题适配 + 所有界面适配 | P2 |

---

## 🏗️ 技术实现需求

### 1. 伪装界面模式

**新增文件**:
- `Views/Disguise/CalculatorView.swift` - 计算器界面
- `ViewModels/CalculatorViewModel.swift` - 计算器逻辑
- `Views/Disguise/DisguiseSettingsView.swift` - 伪装模式设置

**修改文件**:
- `Private_AlbumApp.swift` - 启动逻辑调整
- `Models/AppSettings.swift` - 添加伪装模式开关
- `ViewModels/AuthenticationViewModel.swift` - 密码验证逻辑

**技术要点**:
- 计算器需要真实可用（避免被识破）
- 密码序列检测逻辑（如：1234=）
- 状态持久化（UserDefaults）
- 流畅的界面切换动画

### 2. 无网络验证界面

**修改文件**:
- `Views/Security/NetworkVerificationView.swift` - 完善实现

**技术要点**:
- 读取 Info.plist 网络权限配置
- 展示权限状态（代码级验证）
- 清晰的用户说明文案
- 可能需要系统权限查询 API

### 3. 隐藏空间

**新增文件**:
- `Models/SecretNote.swift` - 笔记数据模型
- `Views/SecretSpace/SecretSpaceView.swift` - 隐藏空间主界面
- `Views/SecretSpace/SecretNoteEditorView.swift` - 笔记编辑器
- `Views/SecretSpace/SecretNoteListView.swift` - 笔记列表
- `ViewModels/SecretSpaceViewModel.swift` - 隐藏空间逻辑
- `Services/SecretSpaceService.swift` - 第二密码和加密服务

**修改文件**:
- `Views/Settings/SettingsView.swift` - 添加隐藏空间设置入口
- `Models/AppSettings.swift` - 添加第二密码状态管理

**技术要点**:
- 独立的密码验证机制
- 独立的加密密钥（与主密码不同）
- SwiftData Schema 扩展（SecretNote）
- 笔记富文本编辑（TextEditor）
- 时间戳管理（创建/修改）

### 4. 文件批量操作增强

**修改文件**:
- `Views/Gallery/GalleryView.swift` - 增加批量操作工具栏
- `ViewModels/GalleryViewModel.swift` - 批量操作逻辑

**新增功能**:
- 批量移动对话框
- 批量导出功能（保持加密或解密导出）
- 操作确认提示

### 5. 深色模式

**修改范围**:
- 全局颜色定义（AppConstants 或 ColorScheme extension）
- 所有 View 文件的颜色适配
- 渐变和主题色调整

**技术要点**:
- 使用 SwiftUI 的 `@Environment(\.colorScheme)`
- 定义 Light/Dark 颜色变量
- 测试所有界面在两种模式下的可读性

---

## 📈 开发工作量估算

| 功能模块 | 文件数量 | 代码行数估算 | 开发时间 | 测试时间 |
|---------|---------|------------|---------|---------|
| 伪装计算器界面 | 3个新文件 + 3个修改 | ~600行 | 2-3天 | 1天 |
| 无网络验证界面 | 1个完善 | ~200行 | 0.5天 | 0.5天 |
| 隐藏空间（核心） | 5个新文件 + 2个修改 | ~800行 | 3-4天 | 1.5天 |
| 文件批量操作增强 | 2个修改 | ~300行 | 1天 | 0.5天 |
| 深色模式 | 全局修改 | ~200行 | 1-2天 | 1天 |
| **总计** | **8个新文件 + 8个修改** | **~2100行** | **7.5-10.5天** | **4.5天** |

**总开发周期**: 约 12-15 工作日（2-3周）

---

## 🎯 建议实施顺序

### Phase 1: 核心安全功能（1周）
1. **无网络验证界面** (优先) - 0.5-1天
   - 建立用户信任的基础
   - 展示应用核心价值

2. **伪装计算器界面** (核心) - 2-3天
   - V1.2 最大亮点功能
   - 需要细致打磨用户体验

### Phase 2: 隐私增强功能（1周）
3. **隐藏空间 + 笔记本** - 3-4天
   - 差异化功能
   - 需要独立加密系统

### Phase 3: 体验优化（3-5天）
4. **文件批量操作增强** - 1天
5. **深色模式** - 1-2天

---

## 🔒 安全性考虑

### 伪装模式安全
- ❗ 密码序列不能太简单（避免误触发）
- ❗ 计算器需要真实可用（防止被识破）
- ❗ 不能在界面上留下任何"这是伪装"的提示
- ❗ 密码错误时不应有任何异常提示

### 隐藏空间安全
- ❗ 第二密码独立存储（不能与主密码相同）
- ❗ 独立的加密密钥系统
- ❗ 笔记数据与主数据物理隔离
- ❗ 未设置第二密码时，完全隐藏入口

### 网络验证
- ❗ 确保 Info.plist 中无任何网络权限声明
- ❗ 代码级别无任何网络调用
- ❗ 第三方库检查（确保无隐藏网络依赖）

---

## 📝 下一步行动

1. ✅ **完成本文档** - 明确功能差距
2. ⏭️ **创建 V1.2 详细实现计划** - 具体技术方案
3. ⏭️ **UI/UX 设计** - 界面原型和交互流程
4. ⏭️ **开发排期** - 分配任务和时间节点
5. ⏭️ **测试计划** - 功能测试和安全审计

---

## ✅ 需求已明确

### 伪装模式
1. ✅ 密码序列格式：**仅支持数字 (0-9) 和小数点 (.)**
2. ✅ 支持自定义密码序列（用户可设置）
3. ✅ 伪装模式下 **不保留计算历史记录**

### 隐藏空间
1. ✅ 笔记 **支持 Markdown 语法**
2. ❌ **不支持笔记附件**（纯文本笔记）
3. ✅ 第二密码通过设置页面的 **开关和修改按钮** 管理

### 批量操作
1. ✅ 批量导出格式：**解密后的原始文件**
2. ❌ **不需要批量重命名**（保持原文件名）

---

**文档状态**: ✅ 完成  
**下一文档**: `V1.2_IMPLEMENTATION_PLAN.md`
