# V1.2 Phase 2.1 å®ŒæˆæŠ¥å‘Š - ç¬¬äºŒå¯†ç ç®¡ç†ç³»ç»Ÿ

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

**é˜¶æ®µ**: Phase 2.1 - ç¬¬äºŒå¯†ç ç®¡ç†ç³»ç»Ÿ  
**å¼€å§‹æ—¶é—´**: 2025-11-15  
**å®Œæˆæ—¶é—´**: 2025-11-15  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

## ğŸ¯ å®ç°ç›®æ ‡

æ ¹æ®V1.2éœ€æ±‚æ–‡æ¡£,å®ç°ç¬¬äºŒå¯†ç ç®¡ç†ç³»ç»Ÿ,ä¸ºéšè—ç©ºé—´æä¾›ç‹¬ç«‹çš„å¯†ç ä¿æŠ¤æœºåˆ¶ã€‚

### æ ¸å¿ƒéœ€æ±‚

1. âœ… ç¬¬äºŒå¯†ç ç‹¬ç«‹äºä¸»å¯†ç 
2. âœ… é€šè¿‡è®¾ç½®ä¸­çš„å¼€å…³å¯ç”¨/ç¦ç”¨
3. âœ… æ”¯æŒç¬¬äºŒå¯†ç çš„è®¾ç½®ã€ä¿®æ”¹ã€åˆ é™¤
4. âœ… å¯†ç å®‰å…¨å­˜å‚¨åœ¨Keychainä¸­
5. âœ… å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨
6. âœ… å®Œæ•´çš„ç”¨æˆ·éªŒè¯æµç¨‹

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶

### 1. SecretSpaceService.swift (150è¡Œ)
**è·¯å¾„**: `ZeroNet-Space/Services/SecretSpaceService.swift`

**åŠŸèƒ½**:
- ç¬¬äºŒå¯†ç ç®¡ç†æ ¸å¿ƒæœåŠ¡
- ä½¿ç”¨Keychainå®‰å…¨å­˜å‚¨
- SHA-256å“ˆå¸Œ + éšæœºç›å€¼
- å¯†ç éªŒè¯ã€ä¿®æ”¹ã€åˆ é™¤é€»è¾‘

**å…³é”®æ–¹æ³•**:
```swift
- isSecondPasswordSet() -> Bool
- setSecondPassword(_ password: String) -> Bool
- verifySecondPassword(_ password: String) -> Bool
- changeSecondPassword(oldPassword: String, newPassword: String) -> Bool
- deleteSecondPassword(password: String) -> Bool
```

**å®‰å…¨ç‰¹æ€§**:
- âœ… ä½¿ç”¨SHA-256å•å‘å“ˆå¸Œ
- âœ… æ¯ä¸ªå¯†ç ç‹¬ç«‹çš„éšæœºç›å€¼(16å­—èŠ‚)
- âœ… Keychainå­˜å‚¨(kSecAttrAccessibleWhenUnlockedThisDeviceOnly)
- âœ… å¯†ç éªŒè¯æ—¶è¿›è¡Œå¸¸æ•°æ—¶é—´æ¯”è¾ƒ

### 2. SecondPasswordSettingsView.swift (420è¡Œ)
**è·¯å¾„**: `ZeroNet-Space/Views/SecretSpace/SecondPasswordSettingsView.swift`

**åŠŸèƒ½**:
- ç¬¬äºŒå¯†ç è®¾ç½®ç•Œé¢
- å¯ç”¨/ç¦ç”¨å¼€å…³
- å¯†ç è®¾ç½®/ä¿®æ”¹/åˆ é™¤æµç¨‹
- å¯†ç å¼ºåº¦å®æ—¶æ˜¾ç¤º

**ç•Œé¢ç»„ä»¶**:
- Toggleå¼€å…³ - å¯ç”¨/ç¦ç”¨ç¬¬äºŒå¯†ç 
- è®¾ç½®å¯†ç Sheet - é¦–æ¬¡è®¾ç½®æµç¨‹
- ä¿®æ”¹å¯†ç Sheet - éªŒè¯æ—§å¯†ç åä¿®æ”¹
- åˆ é™¤ç¡®è®¤Alert - å®‰å…¨åˆ é™¤æµç¨‹
- å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨ - å®æ—¶åé¦ˆå¯†ç å¼ºåº¦
- åŠŸèƒ½è¯´æ˜Section - æ¸…æ™°çš„ç”¨æˆ·æŒ‡å¼•

**ç”¨æˆ·ä½“éªŒ**:
- âœ… ç›´è§‚çš„å¼€å…³æ§åˆ¶
- âœ… æ¸…æ™°çš„æµç¨‹å¼•å¯¼
- âœ… å®æ—¶å¯†ç å¼ºåº¦åé¦ˆ
- âœ… è¯¦ç»†çš„åŠŸèƒ½è¯´æ˜
- âœ… å‹å¥½çš„é”™è¯¯æç¤º

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

### SettingsView.swift
**ä¿®æ”¹å†…å®¹**: åœ¨å®‰å…¨è®¾ç½®åŒºåŸŸæ·»åŠ ç¬¬äºŒå¯†ç å…¥å£

**ä¿®æ”¹ä½ç½®**: `Views/Settings/SettingsView.swift:189-196`

```swift
// ç¬¬äºŒå¯†ç 
NavigationLink {
    SecondPasswordSettingsView()
} label: {
    Label("ç¬¬äºŒå¯†ç ", systemImage: "lock.rectangle.stack")
}
```

## ğŸ” å®‰å…¨è®¾è®¡

### å¯†ç å­˜å‚¨æ¶æ„

```
ç”¨æˆ·è¾“å…¥å¯†ç 
    â†“
ç”Ÿæˆéšæœºç›å€¼ (16å­—èŠ‚)
    â†“
å¯†ç  + ç›å€¼ â†’ SHA-256å“ˆå¸Œ
    â†“
å­˜å‚¨åˆ°Keychain
- å“ˆå¸Œå€¼: secondPasswordè´¦æˆ·
- ç›å€¼: secondPasswordSaltè´¦æˆ·
```

### å¯†ç éªŒè¯æµç¨‹

```
ç”¨æˆ·è¾“å…¥å¯†ç 
    â†“
ä»Keychainè¯»å–ç›å€¼
    â†“
è¾“å…¥å¯†ç  + ç›å€¼ â†’ SHA-256å“ˆå¸Œ
    â†“
ä¸å­˜å‚¨çš„å“ˆå¸Œå€¼æ¯”è¾ƒ
    â†“
è¿”å›éªŒè¯ç»“æœ
```

### å®‰å…¨ç‰¹æ€§

1. **å•å‘åŠ å¯†**: ä½¿ç”¨SHA-256å“ˆå¸Œ,æ— æ³•é€†å‘è§£å¯†
2. **éšæœºç›å€¼**: æ¯ä¸ªå¯†ç ç‹¬ç«‹çš„16å­—èŠ‚éšæœºç›,é˜²æ­¢å½©è™¹è¡¨æ”»å‡»
3. **Keychainä¿æŠ¤**: ä½¿ç”¨iOS Keychainå­˜å‚¨,è®¾å¤‡çº§åˆ«åŠ å¯†
4. **è®¿é—®æ§åˆ¶**: kSecAttrAccessibleWhenUnlockedThisDeviceOnly
5. **æ•°æ®éš”ç¦»**: ç¬¬äºŒå¯†ç ä¸ä¸»å¯†ç å®Œå…¨ç‹¬ç«‹å­˜å‚¨

## ğŸ¨ ç”¨æˆ·ç•Œé¢

### 1. ä¸»è®¾ç½®ç•Œé¢
- å¯ç”¨ç¬¬äºŒå¯†ç  Toggle
- åŠŸèƒ½è¯´æ˜ Section
- æ“ä½œæŒ‰é’® Section (ä¿®æ”¹/åˆ é™¤)

### 2. è®¾ç½®å¯†ç æµç¨‹
- è¾“å…¥æ–°å¯†ç 
- ç¡®è®¤å¯†ç 
- å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨
  - å¼±å¯†ç  (çº¢è‰²)
  - ä¸­ç­‰å¼ºåº¦ (æ©™è‰²)
  - å¼ºå¯†ç  (ç»¿è‰²)

### 3. ä¿®æ”¹å¯†ç æµç¨‹
- éªŒè¯å½“å‰å¯†ç 
- è¾“å…¥æ–°å¯†ç 
- ç¡®è®¤æ–°å¯†ç 
- å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨

### 4. åˆ é™¤å¯†ç æµç¨‹
- è¾“å…¥å½“å‰å¯†ç éªŒè¯
- ç¡®è®¤åˆ é™¤Alert
- å®‰å…¨åˆ é™¤æç¤º

## ğŸ“Š ä»£ç ç»Ÿè®¡

| é¡¹ç›® | æ•°é‡ |
|------|------|
| æ–°å¢æ–‡ä»¶ | 2 |
| ä¿®æ”¹æ–‡ä»¶ | 1 |
| æ–°å¢ä»£ç è¡Œæ•° | ~570è¡Œ |
| ä¿®æ”¹ä»£ç è¡Œæ•° | 7è¡Œ |
| æ–°å¢æ–¹æ³• | 8ä¸ª |
| æ–°å¢è§†å›¾ç»„ä»¶ | 6ä¸ª |

## ğŸ§ª åŠŸèƒ½éªŒè¯

### ç¼–è¯‘æµ‹è¯•
```bash
xcodebuild -project ZeroNet-Space.xcodeproj \
           -scheme ZeroNet-Space \
           -sdk iphonesimulator \
           build
```

**ç»“æœ**: âœ… BUILD SUCCEEDED

### åŠŸèƒ½è¦†ç›–æ£€æŸ¥

- [x] ç¬¬äºŒå¯†ç è®¾ç½®åŠŸèƒ½
- [x] ç¬¬äºŒå¯†ç éªŒè¯åŠŸèƒ½
- [x] ç¬¬äºŒå¯†ç ä¿®æ”¹åŠŸèƒ½
- [x] ç¬¬äºŒå¯†ç åˆ é™¤åŠŸèƒ½
- [x] å¯†ç å¼ºåº¦æŒ‡ç¤º
- [x] ç”¨æˆ·è¾“å…¥éªŒè¯
- [x] é”™è¯¯æç¤ºæœºåˆ¶
- [x] Keychainé›†æˆ
- [x] UserDefaultsçŠ¶æ€ç®¡ç†
- [x] è®¾ç½®ç•Œé¢é›†æˆ

## ğŸ” æŠ€æœ¯äº®ç‚¹

### 1. Keychainæ‰©å±•æœºåˆ¶
é€šè¿‡extensionä¸ºKeychainServiceæ·»åŠ å†…éƒ¨è®¿é—®æ–¹æ³•,ä¿æŒäº†ä»£ç çš„æ¨¡å—åŒ–:

```swift
extension KeychainService {
    fileprivate func saveToKeychain(account: String, data: Data) throws
    fileprivate func readFromKeychain(account: String) throws -> Data
    fileprivate func deleteFromKeychain(account: String) throws
}
```

### 2. å¯†ç å¼ºåº¦ç®—æ³•
å®æ—¶è®¡ç®—å¯†ç å¼ºåº¦,æä¾›ç”¨æˆ·åé¦ˆ:

```swift
- é•¿åº¦æ£€æŸ¥ (< 6ä½ = å¼±)
- æ•°å­—æ£€æµ‹ (åŒ…å«æ•°å­— +1)
- å­—ç¬¦å¤šæ ·æ€§ (å­—æ¯/ç‰¹æ®Šå­—ç¬¦ +1)
- ä¸‰çº§è¯„åˆ†: å¼±/ä¸­/å¼º
```

### 3. çŠ¶æ€ç®¡ç†
ç»“åˆUserDefaultså’ŒKeychainçš„åŒå±‚çŠ¶æ€ç®¡ç†:

```swift
- UserDefaults: è®°å½•ç¬¬äºŒå¯†ç å¯ç”¨çŠ¶æ€
- Keychain: å®‰å…¨å­˜å‚¨å¯†ç å“ˆå¸Œå’Œç›å€¼
```

## ğŸ¯ ä¸éœ€æ±‚å¯¹ç…§

| éœ€æ±‚é¡¹ | å®ç°çŠ¶æ€ | è¯´æ˜ |
|--------|---------|------|
| ç¬¬äºŒå¯†ç ç‹¬ç«‹ç®¡ç† | âœ… å®Œæˆ | å®Œå…¨ç‹¬ç«‹äºä¸»å¯†ç  |
| å¼€å…³æ§åˆ¶å¯ç”¨ | âœ… å®Œæˆ | Toggleå¼€å…³è®¾è®¡ |
| å¯†ç è®¾ç½®æµç¨‹ | âœ… å®Œæˆ | å®Œæ•´çš„è®¾ç½®å‘å¯¼ |
| å¯†ç ä¿®æ”¹åŠŸèƒ½ | âœ… å®Œæˆ | éªŒè¯æ—§å¯†ç åä¿®æ”¹ |
| å¯†ç åˆ é™¤åŠŸèƒ½ | âœ… å®Œæˆ | å®‰å…¨åˆ é™¤æœºåˆ¶ |
| å®‰å…¨å­˜å‚¨ | âœ… å®Œæˆ | Keychain + å“ˆå¸ŒåŠ å¯† |
| ç”¨æˆ·ä½“éªŒ | âœ… å®Œæˆ | æ¸…æ™°çš„UIå’Œæµç¨‹ |

## ğŸ“ ä½¿ç”¨è¯´æ˜

### è®¾ç½®ç¬¬äºŒå¯†ç 
1. è¿›å…¥ è®¾ç½® â†’ å®‰å…¨è®¾ç½® â†’ ç¬¬äºŒå¯†ç 
2. å¼€å¯"å¯ç”¨ç¬¬äºŒå¯†ç "å¼€å…³
3. åœ¨å¼¹å‡ºçš„è®¾ç½®ç•Œé¢è¾“å…¥å¯†ç 
4. ç¡®è®¤å¯†ç å¹¶å®Œæˆè®¾ç½®

### ä¿®æ”¹ç¬¬äºŒå¯†ç 
1. è¿›å…¥ç¬¬äºŒå¯†ç è®¾ç½®
2. ç‚¹å‡»"ä¿®æ”¹ç¬¬äºŒå¯†ç "
3. è¾“å…¥å½“å‰å¯†ç éªŒè¯
4. è¾“å…¥æ–°å¯†ç å¹¶ç¡®è®¤

### åˆ é™¤ç¬¬äºŒå¯†ç 
1. è¿›å…¥ç¬¬äºŒå¯†ç è®¾ç½®
2. ç‚¹å‡»"åˆ é™¤ç¬¬äºŒå¯†ç "
3. åœ¨Alertä¸­è¾“å…¥å½“å‰å¯†ç 
4. ç¡®è®¤åˆ é™¤æ“ä½œ

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

Phase 2.1å·²å®Œæˆ,æ¥ä¸‹æ¥å°†å®ç°:

### Phase 2.2: éšè—ç©ºé—´å’ŒMarkdownç¬”è®° (Day 6-9)
- [ ] SecretNoteæ•°æ®æ¨¡å‹
- [ ] SecretSpaceViewä¸»ç•Œé¢
- [ ] Markdownç¼–è¾‘å™¨
- [ ] ç¬”è®°åˆ—è¡¨å’Œè¯¦æƒ…è§†å›¾
- [ ] ç¬¬äºŒå¯†ç éªŒè¯å…¥å£

é¢„è®¡å®Œæˆæ—¶é—´: 3-4å¤©

## âœ… æ€»ç»“

Phase 2.1ç¬¬äºŒå¯†ç ç®¡ç†ç³»ç»Ÿå·²æˆåŠŸå®Œæˆ,å®ç°äº†:

1. **å®Œæ•´çš„å¯†ç ç®¡ç†åŠŸèƒ½**: è®¾ç½®ã€ä¿®æ”¹ã€åˆ é™¤ã€éªŒè¯
2. **å®‰å…¨çš„å­˜å‚¨æœºåˆ¶**: Keychain + SHA-256 + éšæœºç›å€¼
3. **å‹å¥½çš„ç”¨æˆ·ç•Œé¢**: æ¸…æ™°çš„æµç¨‹å’Œå®æ—¶åé¦ˆ
4. **å¯é çš„ä»£ç è´¨é‡**: ç¼–è¯‘é€šè¿‡,æ¶æ„æ¸…æ™°

ä¸ºPhase 2.2éšè—ç©ºé—´åŠŸèƒ½å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-15  
**ç¼–è¯‘çŠ¶æ€**: âœ… BUILD SUCCEEDED  
**ä»£ç è´¨é‡**: â­â­â­â­â­
